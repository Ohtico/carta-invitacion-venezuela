<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Carta de Invitaci√≥n - Venezuela</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 30px;
        }

        .section h2 {
            color: #667eea;
            font-size: 20px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-group input,
        .form-group select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group input:disabled {
            background-color: #f5f5f5;
            cursor: not-allowed;
        }

        .button-container {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn {
            padding: 15px 40px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .preview-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            overflow: auto;
        }

        .preview-modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .preview-content {
            background: white;
            border-radius: 10px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow: auto;
            position: relative;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }

        .preview-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .preview-close:hover {
            background: #764ba2;
            transform: rotate(90deg);
        }

        .preview-document {
            font-family: 'Times New Roman', serif;
            line-height: 1.8;
            color: #000;
        }

        .preview-document h3 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 16px;
        }

        .preview-document p {
            text-align: justify;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .preview-document .signature {
            margin-top: 40px;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .info-box p {
            color: #0c5460;
            margin: 5px 0;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .button-container {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üáªüá™ Generador de Carta de Invitaci√≥n</h1>
            <p>Para visitar la Rep√∫blica Bolivariana de Venezuela</p>
        </div>

        <div class="content">
            <div id="alert" class="alert"></div>

            <div class="info-box">
                <p><strong>‚ÑπÔ∏è Informaci√≥n:</strong> Complete todos los campos para generar la carta de invitaci√≥n.</p>
            </div>

            <form id="invitationForm">
                <!-- Datos del Invitante -->
                <div class="section">
                    <h2>üìã Datos del Invitante</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Nombre Completo *</label>
                            <input type="text" id="invitanteNombre" placeholder="Ej: JUAN P√âREZ GARC√çA" required>
                        </div>
                        <div class="form-group">
                            <label>C√©dula de Identidad *</label>
                            <input type="text" id="invitanteCedula" placeholder="Ej: V 12.345.678" required>
                        </div>
                        <div class="form-group">
                            <label>Ocupaci√≥n *</label>
                            <input type="text" id="invitanteOcupacion" placeholder="Ej: INGENIERO" required>
                        </div>
                    </div>
                </div>

                <!-- Datos del Invitado -->
                <div class="section">
                    <h2>üë§ Datos del Invitado</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Nombre Completo *</label>
                            <input type="text" id="invitadoNombre" placeholder="Ej: JUAN P√âREZ GARC√çA" required>
                        </div>
                        <div class="form-group">
                            <label>Relaci√≥n *</label>
                            <select id="invitadoRelacion" required>
                                <option value="">Seleccione...</option>
                                <option value="PAREJA">PAREJA</option>
                                <option value="ESPOSA">ESPOSA</option>
                                <option value="ESPOSO">ESPOSO</option>
                                <option value="HIJO">HIJO</option>
                                <option value="HIJA">HIJA</option>
                                <option value="HIJASTRO">HIJASTRO</option>
                                <option value="HIJASTRA">HIJASTRA</option>
                                <option value="PADRE">PADRE</option>
                                <option value="MADRE">MADRE</option>
                                <option value="HERMANO">HERMANO</option>
                                <option value="HERMANA">HERMANA</option>
                                <option value="AMIGO">AMIGO</option>
                                <option value="AMIGA">AMIGA</option>
                                <option value="OTRO">OTRO</option>
                            </select>
                        </div>
                        <div class="form-group" id="otroRelacionGroup" style="display: none;">
                            <label>Especifique la Relaci√≥n *</label>
                            <input type="text" id="otroRelacion" placeholder="Ej: PRIMO, T√çO, SOBRINO, etc.">
                        </div>
                        <div class="form-group">
                            <label>Nacionalidad *</label>
                            <input type="text" id="invitadoNacionalidad" placeholder="Ej: COLOMBIANA" required>
                        </div>
                        <div class="form-group">
                            <label>Edad *</label>
                            <select id="invitadoEdad" required>
                                <option value="">Seleccione...</option>
                                <option value="mayor">Mayor de edad</option>
                                <option value="menor">Menor de edad</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>N√∫mero de Pasaporte *</label>
                            <input type="text" id="invitadoPasaporte" placeholder="Ej: AZ347176" required>
                        </div>
                        <div class="form-group">
                            <label>N√∫mero de ID/C√©dula *</label>
                            <input type="text" id="invitadoID" placeholder="Ej:1234567890" required>
                        </div>
                        <div class="form-group">
                            <label>Ocupaci√≥n *</label>
                            <input type="text" id="invitadoOcupacion" placeholder="Ej: ESTUDIANTE" required>
                        </div>
                        <div class="form-group">
                            <label>Direcci√≥n *</label>
                            <input type="text" id="invitadoDireccion" placeholder="Ej: CALLE 123, CIUDAD, PA√çS" required>
                        </div>
                        <div class="form-group">
                            <label>V√≠a de Transporte *</label>
                            <select id="viaTransporte" required>
                                <option value="">Seleccione...</option>
                                <option value="A√âREA">V√çA A√âREA</option>
                                <option value="TERRESTRE">V√çA TERRESTRE</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Datos del Viaje -->
                <div class="section">
                    <h2>‚úàÔ∏è Datos del Viaje</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Fecha de Ingreso *</label>
                            <input type="date" id="fechaIngreso" required>
                        </div>
                        <div class="form-group">
                            <label>Fecha de Regreso *</label>
                            <input type="date" id="fechaRegreso" required>
                        </div>
                        <div class="form-group">
                            <label>Fecha del Documento *</label>
                            <input type="date" id="fechaDocumento" required>
                        </div>
                    </div>
                </div>

                <!-- Botones -->
                <div class="button-container">
                    <button type="button" class="btn btn-secondary" onclick="limpiarFormulario()">
                        üîÑ Limpiar
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="mostrarPreview()">
                        üëÅÔ∏è Vista Previa
                    </button>
                    <button type="submit" class="btn btn-primary">
                        üìÑ Generar PDF
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Vista Previa -->
    <div id="previewModal" class="preview-modal">
        <div class="preview-content">
            <button class="preview-close" onclick="cerrarPreview()">√ó</button>
            <div id="previewDocument" class="preview-document"></div>
        </div>
    </div>

    <script>
        // Configuraci√≥n de Firebase (los valores ser√°n inyectados por GitHub Actions)
        const firebaseConfig = {
            apiKey: "REPLACE_FIREBASE_API_KEY",
            authDomain: "REPLACE_FIREBASE_AUTH_DOMAIN",
            projectId: "REPLACE_FIREBASE_PROJECT_ID",
            storageBucket: "REPLACE_FIREBASE_STORAGE_BUCKET",
            messagingSenderId: "REPLACE_FIREBASE_MESSAGING_SENDER_ID",
            appId: "REPLACE_FIREBASE_APP_ID"
        };

        // Inicializar Firebase
        let db;
        let firebaseEnabled = false;

        try {
            // Solo inicializar si las credenciales fueron reemplazadas
            if (firebaseConfig.apiKey && !firebaseConfig.apiKey.includes('REPLACE_')) {
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                db = firebase.firestore();
                firebaseEnabled = true;
                console.log('‚úÖ Firebase conectado - M√©tricas habilitadas');
            } else {
                console.log('‚ÑπÔ∏è Firebase no configurado - Funcionando sin m√©tricas');
            }
        } catch (error) {
            console.warn('‚ö†Ô∏è Firebase no disponible:', error.message);
            firebaseEnabled = false;
        }

        // Funci√≥n para registrar generaci√≥n de PDF
        async function registrarGeneracion() {
            if (!firebaseEnabled) return;

            try {
                const generacionData = {
                    fecha: new Date().toISOString(),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    userAgent: navigator.userAgent,
                    idioma: navigator.language
                };

                await db.collection('generaciones').add(generacionData);

                // Actualizar contador global
                const statsRef = db.collection('stats').doc('global');
                await statsRef.set({
                    total: firebase.firestore.FieldValue.increment(1),
                    ultimaActualizacion: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true });

                console.log('‚úÖ Generaci√≥n registrada en Firebase');
            } catch (error) {
                console.warn('‚ö†Ô∏è Error al registrar en Firebase:', error.message);
            }
        }

        // Establecer fecha actual por defecto
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('fechaDocumento').value = today;

            // Manejar cambio en el select de relaci√≥n
            document.getElementById('invitadoRelacion').addEventListener('change', function() {
                const otroGroup = document.getElementById('otroRelacionGroup');
                const otroInput = document.getElementById('otroRelacion');

                if (this.value === 'OTRO') {
                    otroGroup.style.display = 'flex';
                    otroInput.setAttribute('required', 'required');
                } else {
                    otroGroup.style.display = 'none';
                    otroInput.removeAttribute('required');
                    otroInput.value = '';
                }
            });

            // Validaci√≥n de fechas en tiempo real
            const fechaIngresoInput = document.getElementById('fechaIngreso');
            const fechaRegresoInput = document.getElementById('fechaRegreso');

            // Establecer fecha m√≠nima como hoy para ambos campos
            const hoy = new Date().toISOString().split('T')[0];
            fechaIngresoInput.setAttribute('min', hoy);
            fechaRegresoInput.setAttribute('min', hoy);

            fechaIngresoInput.addEventListener('change', function() {
                const fechaSeleccionada = this.value;
                const fechaHoy = new Date().toISOString().split('T')[0];

                // Validar que no sea una fecha pasada
                if (fechaSeleccionada < fechaHoy) {
                    mostrarAlerta('‚ö†Ô∏è La fecha de ingreso no puede ser anterior a hoy', 'error');
                    this.value = '';
                    return;
                }

                // Establecer la fecha m√≠nima de regreso como la fecha de ingreso
                if (fechaSeleccionada) {
                    fechaRegresoInput.setAttribute('min', fechaSeleccionada);

                    // Si ya hay una fecha de regreso seleccionada, validar
                    if (fechaRegresoInput.value && fechaRegresoInput.value <= fechaSeleccionada) {
                        mostrarAlerta('‚ö†Ô∏è La fecha de regreso debe ser posterior a la fecha de ingreso', 'error');
                        fechaRegresoInput.value = '';
                    }
                }
            });

            fechaRegresoInput.addEventListener('change', function() {
                const fechaIngreso = fechaIngresoInput.value;
                const fechaRegreso = this.value;
                const fechaHoy = new Date().toISOString().split('T')[0];

                // Validar que no sea una fecha pasada
                if (fechaRegreso < fechaHoy) {
                    mostrarAlerta('‚ö†Ô∏è La fecha de regreso no puede ser anterior a hoy', 'error');
                    this.value = '';
                    return;
                }

                // Validar que sea posterior a la fecha de ingreso
                if (fechaIngreso && fechaRegreso && fechaRegreso <= fechaIngreso) {
                    mostrarAlerta('‚ö†Ô∏è La fecha de regreso debe ser posterior a la fecha de ingreso', 'error');
                    this.value = '';
                }
            });
        });

        // Funci√≥n para formatear fecha
        function formatearFecha(fecha) {
            const date = new Date(fecha + 'T00:00:00');
            const dia = date.getDate().toString().padStart(2, '0');
            const mes = (date.getMonth() + 1).toString().padStart(2, '0');
            const a√±o = date.getFullYear();
            return `${dia}/${mes}/${a√±o}`;
        }

        // Funci√≥n para formatear fecha en texto
        function formatearFechaTexto(fecha) {
            const date = new Date(fecha + 'T00:00:00');
            const dia = date.getDate();
            const meses = ['ENERO', 'FEBRERO', 'MARZO', 'ABRIL', 'MAYO', 'JUNIO', 
                          'JULIO', 'AGOSTO', 'SEPTIEMBRE', 'OCTUBRE', 'NOVIEMBRE', 'DICIEMBRE'];
            const mes = meses[date.getMonth()];
            const a√±o = date.getFullYear();
            return `${dia} DE ${mes} del ${a√±o}`;
        }

        // Funci√≥n para mostrar alertas
        function mostrarAlerta(mensaje, tipo) {
            const alert = document.getElementById('alert');
            alert.textContent = mensaje;
            alert.className = `alert ${tipo} show`;
            setTimeout(() => {
                alert.className = 'alert';
            }, 5000);
        }

        // Funci√≥n para mostrar vista previa
        function mostrarPreview() {
            // Validar que todos los campos est√©n llenos
            const form = document.getElementById('invitationForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            // Obtener valores del formulario
            const invitanteNombre = document.getElementById('invitanteNombre').value;
            const invitanteCedula = document.getElementById('invitanteCedula').value;
            const invitanteOcupacion = document.getElementById('invitanteOcupacion').value;

            const invitadoNombre = document.getElementById('invitadoNombre').value.toUpperCase();
            let invitadoRelacion = document.getElementById('invitadoRelacion').value;

            if (invitadoRelacion === 'OTRO') {
                invitadoRelacion = document.getElementById('otroRelacion').value.toUpperCase();
            }

            const invitadoNacionalidad = document.getElementById('invitadoNacionalidad').value.toUpperCase();
            const invitadoEdad = document.getElementById('invitadoEdad').value === 'mayor' ? 'mayor de edad' : 'menor de edad';
            const invitadoPasaporte = document.getElementById('invitadoPasaporte').value.toUpperCase();
            const invitadoID = document.getElementById('invitadoID').value;
            const invitadoOcupacion = document.getElementById('invitadoOcupacion').value.toUpperCase();
            const invitadoDireccion = document.getElementById('invitadoDireccion').value.toUpperCase();
            const viaTransporte = document.getElementById('viaTransporte').value;

            const fechaDocumento = formatearFechaTexto(document.getElementById('fechaDocumento').value);
            const fechaIngreso = formatearFecha(document.getElementById('fechaIngreso').value);
            const fechaRegreso = formatearFecha(document.getElementById('fechaRegreso').value);

            // Generar HTML del preview
            const previewHTML = `
                <p style="text-align: left;">${fechaDocumento}</p>

                <h3>INVITACI√ìN A UN EXTRANJERO PARA VISITAR VENEZUELA</h3>

                <p><strong>SE√ëORES:</strong></p>
                <p><strong>SAIME DE LA REP√öBLICA BOLIVARIANA DE VENEZUELA</strong></p>
                <p><strong>MIGRACI√ìN VENEZUELA</strong></p>

                <p style="margin-top: 20px;">
                    Yo ${invitanteNombre}, VENEZOLANO, mayor de edad, Titular de la c√©dula de identidad ${invitanteCedula}
                    OCUPACI√ìN ${invitanteOcupacion} por medio del presente documento hago constar que he decidido realizar una
                    CORDIAL INVITACI√ìN A LA REP√öBLICA BOLIVARIANA DE VENEZUELA, a mi ${invitadoRelacion} ${invitadoNombre}
                    qui√©n es de nacionalidad ${invitadoNacionalidad} ${invitadoEdad} y titular del pasaporte ${invitadoPasaporte}
                    e ID ${invitadoID} su Ocupaci√≥n ${invitadoOcupacion} qui√©n visitar√° ${invitadoDireccion} para pasar unos d√≠as
                    en mi CASA EN VENEZUELA SU TRASLADO SER√Å V√çA ${viaTransporte}.
                </p>

                <p>Agradezco de antemano la atenci√≥n presentada a mi solicitud.</p>

                <p style="margin-top: 20px;">
                    <strong>Fecha de ingreso:</strong> ${fechaIngreso}<br>
                    <strong>Fecha de Regreso:</strong> ${fechaRegreso}
                </p>

                <div class="signature">
                    <p>Atentamente:</p>
                    <p style="margin-top: 40px; border-top: 1px solid #000; display: inline-block; padding-top: 5px; min-width: 300px;">
                        <strong>${invitanteNombre}</strong><br>
                        ${invitanteCedula}
                    </p>
                </div>
            `;

            document.getElementById('previewDocument').innerHTML = previewHTML;
            document.getElementById('previewModal').classList.add('show');
        }

        // Funci√≥n para cerrar vista previa
        function cerrarPreview() {
            document.getElementById('previewModal').classList.remove('show');
        }

        // Cerrar modal al hacer clic fuera del contenido
        document.getElementById('previewModal').addEventListener('click', function(e) {
            if (e.target === this) {
                cerrarPreview();
            }
        });

        // Funci√≥n para limpiar formulario
        function limpiarFormulario() {
            // Limpiar datos del invitante
            document.getElementById('invitanteNombre').value = '';
            document.getElementById('invitanteCedula').value = '';
            document.getElementById('invitanteOcupacion').value = '';

            // Limpiar datos del invitado
            document.getElementById('invitadoNombre').value = '';
            document.getElementById('invitadoRelacion').value = '';
            document.getElementById('otroRelacion').value = '';
            document.getElementById('otroRelacionGroup').style.display = 'none';
            document.getElementById('otroRelacion').removeAttribute('required');
            document.getElementById('invitadoNacionalidad').value = '';
            document.getElementById('invitadoEdad').value = '';
            document.getElementById('invitadoPasaporte').value = '';
            document.getElementById('invitadoID').value = '';
            document.getElementById('invitadoOcupacion').value = '';
            document.getElementById('invitadoDireccion').value = '';
            document.getElementById('viaTransporte').value = '';

            // Limpiar fechas
            document.getElementById('fechaIngreso').value = '';
            document.getElementById('fechaRegreso').value = '';
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('fechaDocumento').value = today;
        }

        // Manejar env√≠o del formulario
        document.getElementById('invitationForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            // Validar fechas
            const fechaIngreso = new Date(document.getElementById('fechaIngreso').value);
            const fechaRegreso = new Date(document.getElementById('fechaRegreso').value);
            
            if (fechaRegreso <= fechaIngreso) {
                mostrarAlerta('‚ùå La fecha de regreso debe ser posterior a la fecha de ingreso', 'error');
                return;
            }

            try {
                await generarPDF();
                await registrarGeneracion(); // Registrar en Firebase
                mostrarAlerta('‚úÖ PDF generado exitosamente', 'success');
            } catch (error) {
                console.error('Error:', error);
                mostrarAlerta('‚ùå Error al generar el PDF. Por favor, intente nuevamente.', 'error');
            }
        });

        // Funci√≥n para justificar texto en jsPDF
        function justificarTexto(doc, texto, x, y, maxWidth) {
            const palabras = texto.trim().split(/\s+/);
            if (palabras.length === 1) {
                doc.text(texto, x, y);
                return;
            }

            // Calcular el ancho del texto sin espacios extra
            const textoSinEspacios = palabras.join(' ');
            const anchoTexto = doc.getTextWidth(textoSinEspacios);

            // Si el texto ya es muy ancho o es la √∫ltima l√≠nea, no justificar
            if (anchoTexto > maxWidth * 0.95) {
                doc.text(textoSinEspacios, x, y);
                return;
            }

            // Calcular espacio entre palabras para justificar
            const espacioTotal = maxWidth - doc.getTextWidth(palabras.join(''));
            const espacioPorPalabra = espacioTotal / (palabras.length - 1);

            // Renderizar cada palabra con el espacio calculado
            let xPos = x;
            palabras.forEach((palabra, index) => {
                doc.text(palabra, xPos, y);
                if (index < palabras.length - 1) {
                    xPos += doc.getTextWidth(palabra) + espacioPorPalabra;
                }
            });
        }

        async function generarPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Obtener valores del formulario
            const invitanteNombre = document.getElementById('invitanteNombre').value;
            const invitanteCedula = document.getElementById('invitanteCedula').value;
            const invitanteOcupacion = document.getElementById('invitanteOcupacion').value;

            const invitadoNombre = document.getElementById('invitadoNombre').value.toUpperCase();
            let invitadoRelacion = document.getElementById('invitadoRelacion').value;

            // Si seleccion√≥ "OTRO", usar el valor del campo de texto
            if (invitadoRelacion === 'OTRO') {
                invitadoRelacion = document.getElementById('otroRelacion').value.toUpperCase();
            }

            const invitadoNacionalidad = document.getElementById('invitadoNacionalidad').value.toUpperCase();
            const invitadoEdad = document.getElementById('invitadoEdad').value === 'mayor' ? 'mayor de edad' : 'menor de edad';
            const invitadoPasaporte = document.getElementById('invitadoPasaporte').value.toUpperCase();
            const invitadoID = document.getElementById('invitadoID').value;
            const invitadoOcupacion = document.getElementById('invitadoOcupacion').value.toUpperCase();
            const invitadoDireccion = document.getElementById('invitadoDireccion').value.toUpperCase();
            const viaTransporte = document.getElementById('viaTransporte').value;

            const fechaDocumento = formatearFechaTexto(document.getElementById('fechaDocumento').value);
            const fechaIngreso = formatearFecha(document.getElementById('fechaIngreso').value);
            const fechaRegreso = formatearFecha(document.getElementById('fechaRegreso').value);

            // Configurar m√°rgenes y ancho
            const margin = 20;
            const pageWidth = doc.internal.pageSize.width;
            const maxWidth = pageWidth - (margin * 2);

            let yPos = 20;

            // T√≠tulo - Fecha
            doc.setFontSize(12);
            doc.text(fechaDocumento, margin, yPos);
            yPos += 15;

            // T√≠tulo principal
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            const titulo = 'INVITACI√ìN A UN EXTRANJERO PARA VISITAR VENEZUELA';
            doc.text(titulo, pageWidth / 2, yPos, { align: 'center' });
            yPos += 15;

            // Destinatarios
            doc.setFontSize(12);
            doc.setFont(undefined, 'bold');
            doc.text('SE√ëORES:', margin, yPos);
            yPos += 8;
            doc.text('SAIME DE LA REP√öBLICA BOLIVARIANA DE VENEZUELA', margin, yPos);
            yPos += 8;
            doc.text('MIGRACI√ìN VENEZUELA', margin, yPos);
            yPos += 15;

            // Cuerpo de la carta
            doc.setFont(undefined, 'normal');
            doc.setFontSize(11);

            const textoPrincipal = `Yo ${invitanteNombre}, VENEZOLANO, mayor de edad, Titular de la c√©dula de identidad ${invitanteCedula} OCUPACI√ìN ${invitanteOcupacion} por medio del presente documento hago constar que he decidido realizar una CORDIAL INVITACI√ìN A LA REP√öBLICA BOLIVARIANA DE VENEZUELA, a mi ${invitadoRelacion} ${invitadoNombre} qui√©n es de nacionalidad ${invitadoNacionalidad} ${invitadoEdad} y titular del pasaporte ${invitadoPasaporte} e ID ${invitadoID} su Ocupaci√≥n ${invitadoOcupacion} qui√©n visitar√° ${invitadoDireccion} para pasar unos d√≠as en mi CASA EN VENEZUELA SU TRASLADO SER√Å V√çA ${viaTransporte}.`;

            const lineas = doc.splitTextToSize(textoPrincipal, maxWidth);
            const lineHeight = 8; // Interlineado mejorado (era 7 antes)

            // Renderizar texto con justificaci√≥n y mejor interlineado
            lineas.forEach((linea, index) => {
                // No justificar la √∫ltima l√≠nea del p√°rrafo
                if (index === lineas.length - 1) {
                    doc.text(linea, margin, yPos);
                } else {
                    // Justificar todas las dem√°s l√≠neas
                    justificarTexto(doc, linea, margin, yPos, maxWidth);
                }
                yPos += lineHeight;
            });

            yPos += 5; // Espacio adicional despu√©s del p√°rrafo

            // Agradecimiento
            doc.text('Agradezco de antemano la atenci√≥n presentada a mi solicitud.', margin, yPos);
            yPos += 15;

            // Fechas de viaje
            doc.text(`Fecha de ingreso: ${fechaIngreso}`, margin, yPos);
            yPos += 10;
            doc.text(`Fecha de Regreso: ${fechaRegreso}`, margin, yPos);
            yPos += 20;

            // Firma
            doc.text('Atentamente:', margin, yPos);
            yPos += 25;

            doc.text('_'.repeat(50), margin, yPos);
            yPos += 8;
            doc.setFont(undefined, 'bold');
            doc.text(invitanteNombre, margin, yPos);
            yPos += 8;
            doc.text(invitanteCedula, margin, yPos);

            // Guardar PDF
            const nombreArchivo = `Carta_Invitacion_${invitadoNombre.replace(/\s+/g, '_')}.pdf`;
            doc.save(nombreArchivo);
        }
    </script>
</body>
</html>